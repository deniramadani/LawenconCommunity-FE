<div class="lg:px-8 p-6">
    <div class="grid mt-5">
        <div class="col-12 lg:col-9 ">
            <div
                class="shadow-2 surface-card p-3 pb-0 border-round-lg my-4 border-2 border-transparent text-900 transition-colors transition-duration-150">
                <div class="flex justify-content-between">
                    <div class="flex">
                        <div *ngIf="post.user.photo == null; then default1 else photoProfile2"></div>
                        <ng-template #default1>
                            <p-avatar styleClass="w-2rem h-2rem" image="../../../../assets/img/default.jpg"
                                shape="circle">
                            </p-avatar>
                        </ng-template>
                        <ng-template #photoProfile2>
                            <p-avatar styleClass="w-2rem h-2rem mx-2 lg:mx-0"
                                image="{{fileDownload}}{{post.user.photo.id}}" shape="circle">
                            </p-avatar>
                        </ng-template>
                        <div class="ml-2">
                            <div class="text-xs font-bold text-900 mb-1" role="button"
                                routerLink="/view/profile/{{post.user.id}}">
                                {{post.user.fullname}}</div>
                            <div class="text-xs flex align-items-center text-700">
                                <span class="text-xs font-italic">{{post.createdAt}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex">
                        <span class="mb-3">
                            <div *ngIf="post.postType.postTypeCode == premium; then premiums "></div>
                            <ng-template #premiums>
                                <p-tag icon="bi bi-star-fill" severity="warning" value="Premium" [rounded]="true">
                                </p-tag>
                            </ng-template>

                        </span>
                    </div>
                </div>
                <div class=" text-lg text-900 font-medium mb-2 line-height-3 mt-3 ">
                    {{post.title}}
                </div>
                <div class=" text-md line-height-3 mb-3 text-700">
                    <div *ngIf="post.postType.postTypeCode == premium; then limit else nolimit "></div>
                    <ng-template #limit>
                        {{ seeMore ? post.body : post.body.substr(0, 80) }}
                        <ng-container *ngIf="post.body.length > 80">... <br>
                            <span> <a type="button" (click)="premiumPost(post.id)" class=" text-blue-500 text-sm my-2">
                                    Read More -></a>
                            </span>
                        </ng-container>
                    </ng-template>
                    <ng-template #nolimit>
                        <p class="text-md ">
                            {{ seeMoreNoPremium ? post.body : post.body.substr(0, 80) }}
                            <ng-container *ngIf="post.body.length > 80">
                                <a class="text-primary text-xs" type="button"
                                    (click)="seeMoreNoPremium = !seeMoreNoPremium;">See {{
                                    seeMoreNoPremium ?
                                    'less' : 'more'}}</a>
                            </ng-container>
                    </ng-template>
                </div>
                <div class="w-full mt-3">
                    <ng-container
                        *ngIf="post.postType.postTypeCode == premium; then thenTemplateFoto; else elseTemplateFoto">
                    </ng-container>
                    <ng-template #thenTemplateFoto>
                        <p-galleria [value]="post.file" [responsiveOptions]="responsiveOptions"
                            [containerStyle]="{'max-width': '100%'}" [numVisible]="5">
                            <ng-template pTemplate="item" let-item>
                                <img src="{{fileDownload}}{{item.file.id}}"
                                    style="width: 100%; height: 300px; display: block;filter: blur(3px)" />
                            </ng-template>
                            <ng-template pTemplate="thumbnail" let-item>
                                <div class="grid grid-nogutter justify-content-center">
                                    <img src="{{fileDownload}}{{item.file.id}}" class="w-full p-3"
                                        style="height: 100px;filter: blur(3px)" />
                                </div>
                            </ng-template>
                        </p-galleria>
                    </ng-template>
                    <ng-template #elseTemplateFoto>
                        <p-galleria [value]="post.file" [responsiveOptions]="responsiveOptions"
                            [containerStyle]="{'max-width': '100%'}" [numVisible]="5">
                            <ng-template pTemplate="item" let-item>
                                <img src="{{fileDownload}}{{item.file.id}}"
                                    style="width: 100%; height: 300px; display: block;" />
                            </ng-template>
                            <ng-template pTemplate="thumbnail" let-item>
                                <div class="grid grid-nogutter justify-content-center">
                                    <img src="{{fileDownload}}{{item.file.id}}" class="w-full p-3"
                                        style="height: 100px;" />
                                </div>
                            </ng-template>
                        </p-galleria>
                    </ng-template>


                </div>
                <div *ngIf="post.postType.postTypeCode == polling;">
                    <div *ngIf="post.optionId != null; then voted else notVoted"></div>
                    <ng-template #voted>
                        <div class="col-12">
                            <div class="flex flex-column w-full px-3 bg-gray-200 p-3 border-round">
                                <span class="text-900 font-medium text-md border-200 pb-2"
                                    style="border-bottom:1px solid;">Category
                                    {{post.question}}
                                </span>
                                <ng-container *ngFor="let option of post.postPollingOption">
                                    <div *ngIf="post.optionId == option.id; then choosed else notChoosed"></div>
                                    <ng-template #choosed>
                                        <div
                                            class="p-button-label pl-3 col-12 bg-primary-900 shadow mb-1 bg-body rounded  text-white ">
                                            <div class="grid w-full p-button-label ">
                                                <div class="col-11 lg:col-11 sm:col-11 text-left">
                                                    {{option.content}}
                                                </div>
                                                <div class="col-1 lg:col-1 sm:col-1  text-left">
                                                    {{option.totalResponse}}
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                    <ng-template #notChoosed>
                                        <div class="p-button-label pl-3 col-12 bg-primary shadow mb-1 bg-body rounded ">
                                            <div class="grid w-full">
                                                <div class="col-11 lg:col-11 sm:col-11 text-left">
                                                    {{option.content }}
                                                </div>
                                                <div class="col-1 lg:col-1 sm:col-1  text-left">
                                                    {{option.totalResponse}}
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ng-container>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template #notVoted>
                        <div class="col-12">
                            <div class="p-5 bg-gray-200 border-round">
                                <div class="card-header bg-primary-900 text-white ">
                                    <p>{{post.question}}</p>
                                </div>
                                <div class="card-body text-black surface-card pt-4">
                                    <div class="grid">
                                        <button *ngFor="let option of post.postPollingOption" pButton pRipple
                                            class="col-12 p-button-raised p-button-info mb-2"
                                            (click)="choose(option.id)" [loading]="loader" type="button">
                                            <div class="grid w-full">
                                                <div class="p-button-label pl-3 col-12 lg:col-12 sm:col-12 text-left">
                                                    {{option.content}}
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </div>
                <div class="mt-4 px-2">
                    <p class="text-secondary font-italic text-xs">{{post.totalLike}} Likes
                        &nbsp;&nbsp;{{post.totalComment}}
                        Comments</p>
                </div>
                <hr>
                <div class="flex">
                    <div class="col-12 lg:col-12 sm:col-12 ">
                        <div class="grid">
                            <div class="col-1 lg:col-1 sm:col-1 ">
                                <div *ngIf="post.likeId != null ; then thenBlock else elseBlock"></div>
                                <ng-template #thenBlock>
                                    <span type="button" (click)="cancelLike(post.likeId, post.postType.postTypeCode)"
                                        class="text-red-600 ">
                                        <i class="bi bi-heart-fill h4"></i>
                                    </span>
                                </ng-template>
                                <ng-template #elseBlock>
                                    <span type="button" (click)="like(post.id, post.postType.postTypeCode)"
                                        class=" text-black ">
                                        <i class="bi bi-heart h4"></i>
                                    </span>
                                </ng-template>
                            </div>
                            <div class="col-10 lg:col-10 sm:col-10 ml-10 lg:ml-0 ">
                                <span type="button" class="h4 text-black">
                                    <i class="bi bi-chat-right-text-fill "></i>
                                </span>
                            </div>
                            <div class="col-1 lg:col-1 sm:col-1 text-right ">
                                <div *ngIf=" post.bookmarkId !=null; then cancelBookmark else saveBookmark"></div>
                                <ng-template #cancelBookmark>
                                    <span type="button"
                                        (click)="unbookmark(post.bookmarkId, post.postType.postTypeCode)"
                                        class=" text-black">
                                        <i class="bi bi-bookmark-fill  h4"></i>
                                    </span>
                                </ng-template>
                                <ng-template #saveBookmark>
                                    <span type="button" (click)="bookmark(post.id, post.postType.postTypeCode)"
                                        class="h4 text-black">
                                        <i class="bi bi-bookmark  "></i>
                                    </span>
                                </ng-template>
                            </div>

                        </div>

                    </div>
                </div>


                <div class="p-3">
                    <div class="grid border-round p-3">
                        <div class="col-12 md:col-12">
                            <form [formGroup]="dataComment" (ngSubmit)="replay()">
                                <div class="p-fluid pr-0">
                                    <label for="message" class="font-medium"> <i class="pi pi-comments"></i>
                                        Comments</label>
                                    <div class="field w-full mt-2 p-0">

                                        <textarea id="message" pInputTextarea rows="1" formControlName="content"
                                            [autoResize]="true" class="py-3 px-3 text-sm"></textarea>
                                    </div>
                                    <button pButton pRipple type="submit" [disabled]="!dataComment.valid" label="Replay"
                                        icon="pi pi-send" class="w-auto" style="float: right;"></button>
                                </div>

                            </form>
                        </div>
                    </div>
                    <div class="grid">
                        <div class="col-12 lg:col-12 py-0" *ngFor="let c of comment">
                            <div class="p-2">
                                <div class="border-1 surface-border border-round p-3 bg-gray-100">
                                    <div class="flex">
                                        <p-avatar image="{{fileDownload}}{{c.user.photo.id}}" shape="circle"></p-avatar>
                                        <div class="ml-2">
                                            <div class="text-sm font-bold text-900 mb-1">{{c.user.fullname}}</div>
                                            <div class="text-xs flex align-items-center text-700">

                                                <span>{{c.createdAt | date : 'E, dd-MM-yyyy'}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="m-0 p-0 line-height-3 mt-3 text-600">
                                        {{c.content}}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-12 lg:col-3"></div>
    </div>
</div>